# Trading Bot Development Journal
## December 14, 2025

---

## What We Started With

The trading bot was making trades based on technical indicators (like MACD, RSI, Bollinger Bands). When the indicator said "sell," the bot would sell immediately - regardless of whether we were making money or losing money on that trade.

---

## The Problem We Discovered

We looked at our trade history and noticed something concerning: **we were selling stocks at a loss, and then those same stocks would recover shortly after**.

Here's what the data showed:
- Our average loss was **-1.75%** per losing trade
- **49% of losing trades** recovered to our sell price within just 1 hour
- **43% recovered to our original buy price** within 1 day

In other words, we were panic-selling during temporary dips, and the stocks would bounce back almost immediately. We were locking in losses that didn't need to happen.

---

## The Solution: Safety Rules

We decided to implement two safety rules:

### Rule 1: 24-Hour Hold Period
**The idea:** When the bot wants to sell at a loss, instead of selling immediately, it waits 24 hours to give the stock a chance to recover.

- If the stock recovers to profitable during those 24 hours → Sell immediately and take the profit
- If 24 hours pass and it's still at a loss and the sell signal is still there → Then sell
- This prevents panic-selling during temporary dips

### Rule 2: 10% Stop-Loss (Emergency Exit)
**The idea:** If a stock drops more than 10% from our purchase price, sell immediately no matter what. This protects us from catastrophic losses.

- This rule overrides the 24-hour hold
- If we're down 10%, something is seriously wrong and we need to get out

---

## Testing the Safety Rules

We ran backtests on TSLA (Tesla) comparing the old rules vs the new safety rules.

### First Test (2 years of hourly data):

| Metric | Old Rules | New Safety Rules |
|--------|-----------|------------------|
| Return | +580% | +283% |
| Win Rate | 41.7% | 77.6% |
| Losses | 250 | 76 |

**Surprising result:** The safety rules dramatically improved our win rate (41% → 77%) and cut our losses by more than half (250 → 76), but we actually made LESS money overall!

---

## The Discovery: One Size Doesn't Fit All

We dug into why this happened and realized something important:

**TSLA is extremely volatile.** It swings up and down multiple times per day. The old "sell quickly" approach let us:
1. Get out fast (even at a small loss)
2. Free up our money
3. Buy back in on the next dip
4. Catch the next wave up

With the safety rules, our money was tied up waiting for recovery, so we missed other opportunities.

**But for less volatile stocks**, the safety rules work great because:
- Dips are usually temporary
- Waiting 24 hours lets the stock recover
- We avoid locking in unnecessary losses

---

## The Final Solution: Per-Stock Optimization

Instead of using the same rules for every stock, we built a system that **automatically figures out the best approach for each stock**.

### How It Works:

1. **During calibration**, the bot tests each stock with BOTH approaches:
   - "Safe" rules (24-hour hold, sell on recovery)
   - "Aggressive" rules (sell immediately on signal)

2. **It compares the results** and picks whichever made more money for that specific stock

3. **It saves this preference** so each stock trades with its optimal rules

### Results Across 10 Stocks:

| Stock | Strategy | Rules | Return | Win Rate |
|-------|----------|-------|--------|----------|
| AMD | Bollinger 20/80 | SAFE | +41.9% | 90.5% |
| TSLA | RSI 30/70 | SAFE | +31.5% | 94.7% |
| GOOGL | Volume Spike | AGGRESSIVE | +21.9% | 75.0% |
| NVDA | Bollinger 20/80 | AGGRESSIVE | +18.0% | 72.7% |
| AAPL | Volume Spike | AGGRESSIVE | +14.7% | 70.4% |
| AMZN | Mean Rev 1% | AGGRESSIVE | +11.2% | 63.6% |
| QQQ | RSI 40/60 | SAFE | +9.1% | 82.6% |
| SPY | Volume Spike | SAFE | +7.8% | 88.1% |
| MSFT | Volume Spike | SAFE | +4.6% | 85.2% |
| META | Volume Spike | SAFE | +2.9% | 84.9% |

**Final split:** 6 stocks using SAFE rules, 4 stocks using AGGRESSIVE rules

---

## Code Changes Made

### 1. Added `use_safety_rules` to StockConfig
Each stock now stores whether it should use safe or aggressive rules.

### 2. Updated `backtest_strategy()` function
- Added `use_safety_rules` parameter
- Implemented "hold mode" logic for safe rules
- Old rules just sell on signal regardless of profit/loss

### 3. Updated `select_best_strategy()` function
- Now tests each strategy with BOTH safe and aggressive rules
- Picks the combination that produces the best return

### 4. Updated `SimpleTrader` class
- Added `hold_mode_positions` dictionary to track which positions are in hold mode
- Trading logic now checks each stock's `use_safety_rules` setting
- Uses appropriate rules based on that stock's configuration

### 5. Updated state saving/loading
- The `use_safety_rules` setting is now saved and restored when the bot restarts

---

## Key Takeaways

1. **Don't panic-sell during temporary dips** - Most stocks recover within hours or a day

2. **But also don't be too rigid** - Some volatile stocks (like tech stocks) benefit from quick trades

3. **Let the data decide** - Instead of guessing, backtest both approaches and use what works best for each stock

4. **Always have a stop-loss** - The 10% emergency exit protects against catastrophic losses regardless of other rules

---

## Files Modified

- `simple_trader.py` - Main trading logic, strategy selection, backtest function
- `data/simple_trader_state.json` - Now stores per-stock rule preferences

---

## Next Steps

- Monitor the bot's performance with the new per-stock rules
- Consider adjusting the calibration period (currently 90 days) to find optimal lookback
- May want to re-calibrate periodically as market conditions change

---

*Journal entry created: December 14, 2025*
